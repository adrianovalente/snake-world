<!doctype html>

<html>
<head>
  <style>
    #canvas {
      border: 1px solid;
    }

    #game-container {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    }

  </style>
</head>
<body>
  <div id="game-container">
    <canvas id="canvas" width="600" height="600"></canvas><br/>
    <h3 id="score-label">Your score: 0</h3>
  </div>
</body>

<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<script type="text/javascript">


  var socket = io();

  var scenario = { height: 40, width: 40 };

  var c = document.getElementById('canvas');
  var ctx = c.getContext('2d');
  var interval, food, direction, snake, score;
  var can_turn = true;
  var maxScore = 0;

  var size = { x: c.width / scenario.width, y: c.height / scenario.height }


  var Direction = {
    RIGHT: 0, LEFT: 1,
    UP: 2, DOWN: 3
  };

  socket.on('update', function(positions) {

    positions = JSON.parse(positions);
    food = positions.food;
    snake = positions.snake;
    draw();

  });

  socket.on('lost', function(data) {

    data = JSON.parse(data);
    alert('you lost! score: ' + data.score);
    window.location.reload();

  });

  socket.on('score', function(data) {
    data = JSON.parse(data);
    document.getElementById('score-label').textContent = 'Your score: ' + data.score;
  });



  function changeDirection(dir) {

    socket.emit('direction', JSON.stringify({dir : dir}));
    direction = dir;
  }



  // listening to keyboard events
  window.addEventListener('keydown', function(e) {

    if (!can_turn) return;
    can_turn = false;

    if (e.keyCode === 39) if (direction != Direction.LEFT)  changeDirection(Direction.RIGHT);
    if (e.keyCode === 37) if (direction != Direction.RIGHT) changeDirection(Direction.LEFT);
    if (e.keyCode === 38) if (direction != Direction.DOWN)  changeDirection(Direction.UP);
    if (e.keyCode === 40) if (direction != Direction.UP)    changeDirection(Direction.DOWN);
  });

  function init_snake() {
    for (var i = 0; i < 5; i++) {
      snake.push({ x: i, y:0 })
    }
  }


  function draw() {

    can_turn = true;
    // cleaning the canvas
    ctx.clearRect(0, 0, c.width, c.height);

    ctx.fillStyle = '#FF0000';

    ctx.fillRect(food.x * size.x, food.y * size.y, size.x, size.y)

    for (var i = 0; i < snake.length; i++) {
      var head = snake[i];
      ctx.fillRect(head.x * size.x, head.y * size.y, size.x, size.y)
    }

  }




</script>

</html>
