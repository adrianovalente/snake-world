<!doctype html>

<html>
<head>
  <style>
    #canvas {
      border: 1px solid;
    }

    #game-container {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    }

  </style>
</head>
<body>
  <div id="game-container">
    <canvas id="canvas" width="600" height="600"></canvas><br/>
    <h3 id="score-label">Your score: 0</h3>
  </div>
</body>


<script type="text/javascript">

  var scenario = { height: 40, width: 40 }

  var c = document.getElementById('canvas');
  var ctx = c.getContext('2d');
  var interval, food, direction, snake, score;
  var can_turn = true;
  var maxScore = 0;

  var size = { x: c.width / scenario.width, y: c.height / scenario.height }


  var Direction = {
    RIGHT: 0, LEFT: 1,
    UP: 2, DOWN: 3
  };

  start();

  // listening to keyboard events
  window.addEventListener('keydown', function(e) {

    if (!can_turn) return;
    can_turn = false;

    if (e.keyCode === 39) if (direction != Direction.LEFT)  direction = Direction.RIGHT;
    if (e.keyCode === 37) if (direction != Direction.RIGHT) direction = Direction.LEFT;
    if (e.keyCode === 38) if (direction != Direction.DOWN)  direction = Direction.UP;
    if (e.keyCode === 40) if (direction != Direction.UP)    direction = Direction.DOWN;
  });

  function init_snake() {
    for (var i = 0; i < 5; i++) {
      snake.push({ x: i, y:0 })
    }
  }

  function init_food() {
    food = {
      x: Math.floor(Math.random() * scenario.width),
      y: Math.floor(Math.random() * scenario.height)
    }
  }

  function update_snake() {
    var snake_head = snake[snake.length - 1];

    var new_head = { x: snake_head.x, y: snake_head.y}

    if (direction === Direction.RIGHT)  new_head.x ++;
    if (direction === Direction.LEFT) new_head.x --;
    if (direction === Direction.UP) new_head.y --;
    if (direction === Direction.DOWN) new_head.y ++;

    snake.push(new_head);

    if(new_head.x == food.x && new_head.y == food.y) {

      score++;
      document.getElementById('score-label').textContent = 'Your score: ' + score;

      init_food();

    } else {
      snake.shift();
    }

    if (should_die()) die();

    draw();
    can_turn = true;

  }


  function should_die() {
    var snake_head = snake[snake.length - 1];
    if (snake_head.x < 0 || snake_head.x > scenario.width) return true;
    if (snake_head.y < 0 || snake_head.y > scenario.height) return true;

    for (var i = 0; i < snake.length - 1; i++) {
      var pixel = snake[i];
      if (pixel.x == snake_head.x && pixel.y == snake_head.y) return true;
    }
  }

  function draw() {

    // cleaning the canvas
    ctx.clearRect(0, 0, c.width, c.height);

    ctx.fillStyle = '#FF0000';

    ctx.fillRect(food.x * size.x, food.y * size.y, size.x, size.y)

    for (var i = 0; i < snake.length; i++) {
      var head = snake[i];
      ctx.fillRect(head.x * size.x, head.y * size.y, size.x, size.y)
    }

  }

  function die() {
    clearInterval(interval);
    if (score > maxScore) maxScore = score;
    alert('You lost!\nYour score: ' + score + '\nMax score: ' + maxScore);
    start();
  }

  function start() {
    score = 0;
    document.getElementById('score-label').textContent = 'Your score: ' + score;
    direction = Direction.RIGHT;
    snake = [];
    init_food();
    init_snake();
    update_snake();
    interval = setInterval(update_snake, 60);
  }



</script>

</html>
